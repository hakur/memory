# 1.操作系统锁的实现
> 

# 2.分布式锁
> ### 产生原因
    在单体单实例程序的运行过程中，如果发生了多线程竞争同一件事，如写入修改redis缓存。
    比如线程A、B，A往里面写入了数据，但此时BC也想写入数据，如果A修改了用户资料的年龄字段，B修改了用户昵称但没有修改年龄，如果不加锁当A写完之后B再去覆盖则会导致只保留了B的修改，而A的修改被B覆盖了，这种情况可以用锁来阻止B线程写入旧的年龄数据。
> ### 实现方式
* redis kv存储来表示锁被谁占用
* etcd kv存储来表示锁被谁占用，如 新建一个key的名称叫 lock_user_modify，它的value是{lock_id: 123456-fsdfs-fsdfs-fs,expire: 15893045678}

> ### 注意事项
* 锁需要有超时机制
* 锁需要有重试强锁的最大重试次数